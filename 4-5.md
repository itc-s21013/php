 # 「重要な処理」の際に混入する脆弱性

 ## 攻撃手法と理屈
 - 入力-実行パターンのCSRF攻撃  
	1. 攻撃者が罠サイトを用意する  
	1. 被害者が罠サイトを閲覧する  
	1. 罠サイトのJavaScriptにより、被害者のブラウザ上で攻撃対象サイトに対し、新しいパスワードが送信される。  
	1. パスワードが変更される。

 - 確認画面がある場合のCSRF攻撃  
hiddenパラメータを使う方法  
入力画面で入力されたメールアドレスをhiddenパラメータとして確認画面に埋め込ませ、実行画面に渡す。このCSRF攻撃は、確認画面がない場合と同じ。
セッション変数によりパラメータを受け渡ししている場合
- 確認画面で受け取ったメールアドレスをセッション変数に格納することにより、実行画面に受け渡す。  
- 攻撃者が指定したメールアドレスに変更させられる。
 ## 脆弱性が生まれる原因
- form要素のaction属性にはどのドメインのURLでも指定できる
- クッキーに保管されたセッションIDは、対象サイトに自動的に送信される
 ## 対策
 - CSRF対策の必要なページを区別する。
 - 正規利用者の意図したリクエストを確認できるよう実装する。
 - 秘密情報(トークン)の埋め込み
 - パスワード再入力
 - Refererのチェック
